<% if @workout.nil? %>
	<div class="jumbotron">
		<h1 class="display-4">There are no Workouts for you!</h1>
		<p class="lead">Check with your gym and see if they have set the workouts up!</p>
	</div>
<% elsif  @workout_group.nil? %>
	<div class="jumbotron">
		<h1 class="display-4">There are no Workouts for you!</h1>
		<p class="lead">Awesome job this week. You have completed all workouts for this program for the week. Rest and let your body do what it was made to do....evolve!</p>
	</div>
<% else %>
	<% if @user.current_workout.nil? %>
		<div class="row">
			<div class="col-md-9 text-muted">Your next workout, if you choose to accept it. Below is an overview of each workout and it's exercises.</div>
		  <div class="col-md-3 text-right">
				<div class="btn-group" role="group">
					<%= button_to "Yes", accept_deny_workout_path(accept: true, workout_id: @workout.id), remote: true, class: 'btn btn-secondary btn-sm btn-success' %><%= button_to "No", accept_deny_workout_path(deny: true, workout_id: @workout.id), class: 'btn btn-secondary btn-sm btn-danger' %>
				</div>
			</div>
		</div>
	<% end %>


	<% if @already_worked_out %>
		<div class="jumbotron">
			<h1 class="display-4">Awesome Workout Today!</h1>
			<p class="lead">Come back tomorrow and get some more. Keep it up and the results will come!</p>
		</div>
	<% else %>

		<%= form_for :exercises, url: create_workout_detail_path do |f| %>
			<div class="card" style="margin-bottom:20px;">
			  <div class="card-body workout-header">
			  	<div class="row text-center">
				  	<div class="col-md-12">
				  		<h3><%= @workout_group.name %></h3>
				  	</div>
						
						<% if @user.current_workout == @workout.id %>
							<div class="col-md-12" style="margin-bottom:20px;">
								<%= f.submit "Log It", class: 'btn btn-block btn-lg log-it-btn' %>
							</div>
						<% end %>
					</div>
			  </div>
			</div>

			<% if @user.current_workout.nil? %>
				<table class="table table">
					<tbody>
			  		<% @workout.workout_groups.each do |group| %>
			  			<tr>
			  				<th scope="col" colspan="3" class="text-center bg-success"><%= group.name %></th>
			  			</tr>
			  			<tr class="table-success">
			  				<th>Exercise</th>
			  				<th>Sets</th>
			  				<th>Rep Range</th>
			  			</tr>
			  			<% group.exercises.each do |exercise| %>
						    <tr>
						      <th scope="row"><%= exercise.name %></th>
						      <td><%= exercise.set_count %></td>
						      <td><%= exercise.rep_range %></td>
						    </tr>
						  <% end %>
			  		<% end %>
			  	</tbody>
			  </table>
	  	<% else %>
	  		<div class="progress" style="height:35px">
				  <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%;color:black;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0% complete</div>
				</div>

	  		<div class="row" style="margin-top:20px;margin-bottom:20px;">
						<div class="col-md-6 col-sm-6 col-6 text-left">
							<%= link_to "Prev", nil, id: 'prev-exercise', class: 'btn btn-block btn-danger' %>
						</div>
						<div class="col-md-6 col-sm-6 col-6 text-right">
							<%= link_to "Next", nil, id: 'next-exercise', class: 'btn btn-block btn-warning' %>
						</div>
					</div>

	  		<% @exercise_groups.each_with_index do |exercise_group, ex_group_idx| %>
	  			<% bg_color = Category.style_tags.to_a.sample[1] %>
	  			<% card_display = 'none' if ex_group_idx != 0 %>
	  			<div class="card <%= bg_color['background-color'] %> exercise-card" style="display:<%= card_display %>">
	  				 <div class="card-header <%= bg_color['border'] %>" id="heading<%= ex_group_idx %>">
					      <h5 class="mb-0 row">
					      	<div style="overflow:auto;" class="col-md-6">
						        <a class="btn btn-link" data-toggle="collapse" data-target="#collapse<%= ex_group_idx %>" aria-expanded="true" aria-controls="collapse<%= ex_group_idx %>">
						          <%= exercise_group[1].collect { |ex| ex.name }.join('/') %>
						        </a>
						      </div>
						      <div class="col-md-3 exercise-counter text-right">0 of <%= exercise_group[1].count %> complete</div>
					      </h5>
					    </div>

					    <div class="card-body">
						  		<% exercise_group[1].each_with_index do |exercise, ex_idx| %>
	  								<% @prev_exercise = @last_workout.find_by(exercise_id: exercise.id) %>
						  			<div class="row exercise-row" style="height:5%;border-bottom:1px solid black;<%= bg_color['style'] %>">
						      		<div class="col-md-3 col-sm-3 col-3" style="margin-top:10px;">
						      			<%= exercise.name %>
						      		</div>
						      		<div class="col-md-3 col-sm-3 col-3" style="margin-top:10px;"><i><%= exercise.description %></i></div>
						      		<div class="col-md-3 col-sm-3 col-3" style="margin-top:10px;">
						      			<%= exercise.set_count %> Sets
						      		</div>
						      		<div class="col-md-3 col-sm-3 col-3" style="margin-top:10px;">
						      			<%= exercise.rep_range %> Reps
						      		</div>
						      	</div>

								    <%= f.fields_for 'workout_detail[]', exercise.workout_details.new do |workout_detail| %>
							      	<%= workout_detail.hidden_field :exercise_id, value: "#{exercise.id}" %>
							      	<%= workout_detail.hidden_field :workout_group_id, value: "#{exercise.workout_group_id}" %>
							      	<%= workout_detail.hidden_field :workout_date, value: "#{DateTime.now.in_time_zone}" %>

							      	<div class="row" style="padding-bottom:30px;">
								      	<% col_space = 4 %>
									      <% 1.upto(exercise.set_count) do |num| %>
								      		<% if @user.current_workout == @workout.id %>
								      			<% if @prev_exercise.nil? %>
								      				<div class="col-md-<%= col_space %> col-sm-<%= col_space %> col-<%= col_space %> rep" style="padding-top:30px;"><%= workout_detail.text_field "rep_#{num}_weight", size: 3, class: "rep_input form-control" %></div>
								      			<% else %>
								      				<div class="col-md-<%= col_space %> col-sm-<%= col_space %> col-<%= col_space %> rep" style="padding-top:30px;"><%= workout_detail.text_field "rep_#{num}_weight", size: 3, class: "rep_input form-control", placeholder: @prev_exercise["rep_#{num}_weight"] %></div>
								      			<% end %>
								      		<% end %>
									      <% end %>
							      	</div>

							      	<div class="row" style="padding-bottom:30px;border-bottom:1px solid black;">
							      		<%= workout_detail.text_area :comment, class: "col-md-12 form-control", placeholder: "Enter exercise comment here" %>
							      	</div>
								    <% end %>
									<% end %>
								</div>
	  			</div>
	  		<% end %>
			<% end %>
		<% end %>
	<% end %>
<% end %>

<script>
	$('#next-exercise').on('click', function(e){
		e.preventDefault();

		let visibleCard;
		if ($('.exercise-card:visible').length === 0) {
			visibleCard = $('.exercise-card').first();
			visibleCard.css('display', '');
		} else {
			visibleCard = $('.exercise-card:visible');
			visibleCard.css('display', 'none');
			visibleCard.next().css('display', '');
		}
	});

	$('#prev-exercise').on('click', function(e){
		e.preventDefault();

		let visibleCard;
		if ($('.exercise-card:visible').length === 0) {
			visibleCard = $('.exercise-card').last();
			visibleCard.css('display', '');
		} else {
			visibleCard = $('.exercise-card:visible');
			visibleCard.css('display', 'none');
			visibleCard.prev().css('display', '');
		};
	});
</script>
