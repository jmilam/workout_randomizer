<%= render "partials/alert" %>
<div class="container">
	<ul class="nav nav-pills" id="workoutTab" role="tablist" style="margin-bottom:30px;">
	  <li class='nav-item'><a class='nav-link active' id='profile-tab' data-toggle='tab' href='#profile' role='tab' aria-controls='profile' aira-selected='true'>Gym Information</a></li>
	  <li class='nav-item'><a class='nav-link' id='workout-trending-tab' data-toggle='tab' href='#workout-trending' role='tab' aria-controls='workout-trending' aria-selected='true'>Gym Kiosks <span class="badge badge-pill badge-secondary"><%= @gym.kiosks.count %></span></a></li>
	  <li class='nav-item'><a class='nav-link' id='gym-users-tab' data-toggle='tab' href='#gym-users' role='tab' aria-controls='gym-users' aria-selected='true'>Gym Users <span class="badge badge-pill badge-secondary"><%= @gym_users.count %></span></a></li>
	  <li class='nav-item'><a class='nav-link' id='popup-workout-tab' data-toggle='tab' href='#popup-workout' role='tab' aria-controls='popup-workout' aria-selected='true'>Daily Popup Workouts</span></a></li>
	</ul>

	<div class="tab-content" id="workoutTabContent">
	  <div class="tab-pane fade show active" id='profile' role='tabpanel' aria-labelledby='profile'>
			<%= form_for @gym, url: gym_path, method: :put do |f| %>
			  <div class="row">
			    <div class="col-md-6 col-sm-12 form-group">
						<%= f.label :name %>
						<%= f.text_field :name, class: 'form-control' %>
					</div>
					<div class="col-md-6 col-sm-12">
						<%= f.label :phone_number %>
						<%= f.text_field :phone_number, class: 'form-control' %>
					</div>
				</div>

				<div class="row">
			    <div class="col-md-12 col-sm-12 form-group">
						<%= f.label :address %>
						<%= f.text_field :address, class: 'form-control' %>
					</div>
				</div>

				<div class="row">
			    <div class="col-md-4 col-sm-12 form-group">
			    	<%= f.label :city %>
						<%= f.text_field :city, class: 'form-control' %>
			    </div>
			    <div class="col-md-4 col-sm-12 form-group">
			    	<%= f.label :state %>
						<%= f.text_field :state, class: 'form-control' %>
			    </div>
			    <div class="col-md-4 col-sm-12 form-group">
			    	<%= f.label :zipcode %>
						<%= f.text_field :zipcode, class: 'form-control' %>
			    </div>
			  </div>

			  <div class="row">
			    <div class="col-md-5 col-sm-5 col-5 form-group">
			    	<%= f.label 'Users' %>
			    	<%= select_tag 'users', options_for_select(@non_admins), multiple: true, class: 'form-control' %>
			    </div>

			    <div class="col-md-2 col-sm-2 col-2">
			    	<button class="btn btn-warning" id="add-admin">-></button>
			    	<button class="btn btn-danger" id="remove-admin"><-</button>

			    </div>

			    <div class="col-md-5 col-sm-5 col-5 form-group">
						<%= f.label :admin_ids %>
						<%= f.select :admin_ids, options_for_select(@admins), {}, multiple: true, class: 'form-control' %>
					</div>
				</div>

				<div class="row">
				  <div class="col-12">
						<%= f.label :logo, "Upload Gym Logo: " %>
					</div>

					<div class="col-12">
						<%= f.file_field :logo %>
					</div>
				</div>

				<%= f.submit "Update Gym Info", class: "btn btn-lg btn-block workout-btn", style: 'margin-bottom: 15px;', id: 'gym-update' %>
			<% end %>
		</div>
		<div class="tab-pane fade show" id='workout-trending' role='tabpanel' aria-labelledby='workout-trending'>
			<table class="table">
				<thead>
					<tr>
						<th>Kiosk Number</th>
						<th>Exercise</th>
					</tr>
				</thead>
				<tbody>
					<% @gym.kiosks.each do |kiosk| %>
						<tr>
							<td><%= kiosk.kiosk_number %></td>
							<td style="color: #101216"><i><%= Exercise.find(kiosk.exercise_id).name %></i></td>
						</tr>
					<% end %>
				</tbody>
			</table>

			<div class="container">
				<%= form_for :kiosk, url: create_kiosk_path do |f| %>
					<%= f.hidden_field :gym_id, value: @gym.id %>
					<div class="row">
						<%= f.text_field :kiosk_number, placeholder: "Enter Kiosk Number", class: 'form-control col-md-4 col-sm-4 col-6', style: 'margin-bottom:15px;' %>
						<%= f.select :exercise_id, @exercises, {}, class: 'form-control col-md-4 col-sm-4 col-5 offset-1', style: 'margin-bottom:15px;' %>
						<%= f.submit 'Save Kiosk', class: 'col-md-2 col-sm-2 col-12 form-control', style: 'background-color:#BFF075;margin-bottom:15px;' %>
					</div>
				<% end %>
			</div>
		</div>
		<div class="tab-pane fade show" id='gym-users' role='tabpanel' aria-labelledby='gym-users'>
			<table class="table">
				<thead>
					<tr>
						<th>User Name</th>
						<th>Current WOrkout</th>
					</tr>
				</thead>
				<tbody>
					<% @gym_users.each do |user| %>
						<tr>
							<td><%= link_to "#{user.first_name} #{user.last_name}", edit_profile_path(user.id) %></td>
							<td style="color: #101216"><i><%= user.current_workout_name %></i></td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
		<div class="tab-pane fade show" id='popup-workout' role='tabpanel' aria-labelledby='popup-workout'>
			<table class="table">
				<thead>
					<tr>
						<th>Workout Name</th>
						<th>Workout Date</th>
					</tr>
				</thead>
				<tbody>
					<% @popup_workouts.each do |popup| %>
						<tr>
							<td><%= popup.workout_group.name %></td>
							<td><%= popup.workout_date.strftime("%m-%d-%Y") %></td>
						</tr>
					<% end %>
				</tbody>
			</table>
			<%= button_to "Setup a Pop Up Workout", new_wod_path, method: :get, class: "btn btn-lg workout-btn" %>

		</div>
	</div>
</div>

<script>
	$('#gym-update').on('click', function(e) {
		e.preventDefault();
		$('#gym_admin_ids option').prop('selected', true);
		$('.edit_gym').submit();
	});

	$('#add-admin, #remove-admin').on('click', function(e){
		e.preventDefault();

		if ($(this).attr('id') === 'add-admin'){
			$('#gym_admin_ids').append($('#users option:selected'))
		} else {
			$('#users').append($('#gym_admin_ids option:selected'))
		}
	});
</script>